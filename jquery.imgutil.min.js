/*! jQuery.imgUtil (https://github.com/Takazudo/jQuery.imgUtil)
 * lastupdate: 2013-05-24
 * version: 0.2.0
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){var t=[].slice,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};(function(e){var i;return i={},i.Event=function(){function e(){}return e.prototype.on=function(t,e){var n,i,r,o,h;for(null==this._callbacks&&(this._callbacks={}),n=t.split(" "),o=0,h=n.length;h>o;o++)i=n[o],(r=this._callbacks)[i]||(r[i]=[]),this._callbacks[i].push(e);return this},e.prototype.once=function(t,e){return this.on(t,function(){return this.off(t,arguments.callee),e.apply(this,arguments)}),this},e.prototype.trigger=function(){var e,n,i,r,o,h,u;if(e=arguments.length>=1?t.call(arguments,0):[],i=e.shift(),r=null!=(u=this._callbacks)?u[i]:void 0){for(o=0,h=r.length;h>o&&(n=r[o],n.apply(this,e)!==!1);o++);return this}},e.prototype.off=function(t,e){var n,i,r,o,h,u;if(!t)return this._callbacks={},this;if(r=null!=(u=this._callbacks)?u[t]:void 0,!r)return this;if(!e)return delete this._callbacks[t],this;for(i=o=0,h=r.length;h>o;i=++o)if(n=r[i],n===e){r=r.slice(),r.splice(i,1),this._callbacks[t]=r;break}return this},e}(),function(){var t,n,r,o,h;return r={},t=null,n=function(){return e.Deferred(function(n){return e(function(){return t=e('<div id="calcNaturalWH-tempholder"></div>').css({position:"absolute",left:"-9999px",top:"-9999px"}),e("body").append(t),n.resolve()})}).promise()},o=function(t){return null==t.naturalWidth||0===t.naturalWidth||null==t.naturalHeight||0===t.naturalHeight?!1:!0},h=function(n,i){var o,h,u,c,l,a;return n=n.clone(),c=n[0],u=e.Deferred(),a={},n.css({width:"auto",height:"auto"}),o=e("<div></div>").append(n),t.append(o),h=0,l=function(){return a.width=c.naturalWidth||n.width(),a.height=c.naturalHeight||n.height(),h>10?(o.remove(),u.reject()):a.width&&a.height?(r[i],o.remove(),u.resolve(a)):(h++,wait(100).done(function(){return l()}))},l(),u.promise()},i.calcNaturalWH=e.ImgLoaderNs.createCachedFunction(function(t,i){return e.loadImg(i).then(function(e){var u,c;return u=e[0],o(u)?(c={width:u.naturalWidth,height:u.naturalHeight},r[i]=c,t.resolve(c,e)):n().done(function(){return h(e,i).then(function(n){return t.resolve(n,e)},function(){return t.reject()})})},function(){return t.reject()})})}(),i.calcRectFitImgWH=function(){var t,n,r;return t=function(t,e){return t>e?t:e},n=function(t,e,n,i){var r,o;return n>t&&i>e?{width:t,height:e}:(o=n/t,r=i/e,r>o?{width:n,height:Math.ceil(e*o)}:o>r?{width:Math.ceil(t*r),height:i}:o===r?{width:t*o,height:e*r}:void 0)},r=function(t){return{width:100*t.width,height:100*t.height}},function(t,o){var h,u,c,l;return c=e.extend({width:null,height:null,enlargeSmallImg:!0,returnClonedImg:!0},o),h=e.Deferred(),l=function(t,e){var i;return c.enlargeSmallImg&&(t=r(t)),c.returnClonedImg&&(e=e.clone()),i=n(t.width,t.height,c.width,c.height),h.resolve({width:i.width,height:i.height,img:e})},u=function(){return h.reject()},i.calcNaturalWH(t).then(l,u),h.promise()}}(),i.ImgCoverRect=function(t){function r(t,n){var r,o,h=this;this.$el=t,this.options=e.extend(i.ImgCoverRect.defaults,n),o=this.$el.attr("data-imgcoverrect-src"),o&&(this.options.src=o),this.rectWidth=this.$el.width(),this.rectHeight=this.$el.height(),this.options.oninit&&(r={rectWidth:this.rectWidth,rectHeight:this.rectHeight,el:this.$el},this.options.oninit(r)),this.loadImg().then(function(t,n){var i,r,o;i=h.calcImgSize(t),r=h.calcAdjustStyles(i),o=e.extend(i,r),n.css(o),h.$el.empty().append(n)},function(){h.options.onfail&&h.options.onfail()})}return n(r,t),r.defaults={src:null,oninit:null,onfail:null,cloneImg:!0},r.prototype.loadImg=function(){var t,n=this;return t=e.Deferred(),i.calcNaturalWH(this.options.src).then(function(e,i){return n.options.cloneImg&&(i=i.clone()),t.resolve(e,i)},function(){return t.reject()}),t.promise()},r.prototype.calcImgSize=function(t){var e,n,i,r,o,h,u,c;return h={},r=this.rectWidth,i=this.rectHeight,n=t.width,e=t.height,c=function(){var t,o;return o=r/n,t=Math.floor(o*e),i>t?!1:{adjustedImgWidth:r,adjustedImgHeight:t}},u=function(){var t,o;return o=i/e,t=Math.floor(o*n),r>t?!1:{adjustedImgWidth:t,adjustedImgHeight:i}},o=c(),o===!1&&(o=u()),h.width=o.adjustedImgWidth,h.height=o.adjustedImgHeight,h},r.prototype.calcAdjustStyles=function(t){var e,n,i,r,o;return o={},r=this.rectWidth,i=this.rectHeight,n=t.width,e=t.height,n>r&&(o.left=-1*Math.floor((n-r)/2)),e>i&&(o.top=-1*Math.floor((e-i)/2)),o},r}(i.Event),e.fn.imgCoverRect=function(t){return this.each(function(n,r){var o;return o=e(r),o.data("imgcoverrect",new i.ImgCoverRect(o,t))})},e.imgUtil=i})(jQuery,window,document)}).call(this);