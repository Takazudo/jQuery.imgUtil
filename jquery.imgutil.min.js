/*! jQuery.imgUtil (https://github.com/Takazudo/jQuery.imgUtil)
 * lastupdate: 2013-05-18
 * version: 0.1.0
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){(function(t){var e;return e={},function(){var n,r,i,u,h;return i={},n=null,r=function(){return t.Deferred(function(e){return t(function(){return n=t('<div id="calcNaturalWH-tempholder"></div>').css({position:"absolute",left:"-9999px",top:"-9999px"}),t("body").append(n),e.resolve()})}).promise()},u=function(t){return null==t.naturalWidth||0===t.naturalWidth||null==t.naturalHeight||0===t.naturalHeight?!1:!0},h=function(e,r){var u,h,o,a,l,c;return e=e.clone(),a=e[0],o=t.Deferred(),c={},e.css({width:"auto",height:"auto"}),u=t("<div></div>").append(e),n.append(u),h=0,l=function(){return c.width=a.naturalWidth||e.width(),c.height=a.naturalHeight||e.height(),h>10?(u.remove(),o.reject()):c.width&&c.height?(i[r],u.remove(),o.resolve(c)):(h++,wait(100).done(function(){return l()}))},l(),o.promise()},e.calcNaturalWH=t.ImgLoaderNs.createCachedFunction(function(e,n){return t.loadImg(n).then(function(t){var o,a;return o=t[0],u(o)?(a={width:o.naturalWidth,height:o.naturalHeight},i[n]=a,e.resolve(a,t)):r().done(function(){return h(t,n).then(function(n){return e.resolve(n,t)},function(){return e.reject()})})},function(){return e.reject()})})}(),e.calcRectFitImgWH=function(){var n,r,i;return n=function(t,e){return t>e?t:e},r=function(t,e,n,r){var i,u;return n>t&&r>e?{width:t,height:e}:(u=n/t,i=r/e,i>u?{width:n,height:Math.ceil(e*u)}:u>i?{width:Math.ceil(t*i),height:r}:u===i?{width:t*u,height:e*i}:void 0)},i=function(t){return{width:100*t.width,height:100*t.height}},function(n,u){var h,o,a,l;return a=t.extend({width:null,height:null,enlargeSmallImg:!0,returnClonedImg:!0},u),h=t.Deferred(),l=function(t,e){var n;return a.enlargeSmallImg&&(t=i(t)),a.returnClonedImg&&(e=e.clone()),n=r(t.width,t.height,a.width,a.height),h.resolve({width:n.width,height:n.height,img:e})},o=function(){return h.reject()},e.calcNaturalWH(n).then(l,o),h.promise()}}(),t.imgUtil=e})(jQuery,window,document)}).call(this);