/*! jQuery.imgUtil (https://github.com/Takazudo/jQuery.imgUtil)
 * lastupdate: 2013-05-24
 * version: 0.2.0
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){var t=[].slice,e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};(function(e){var i;return i={},i.Event=function(){function e(){}return e.prototype.on=function(t,e){var n,i,r,h,o;for(null==this._callbacks&&(this._callbacks={}),n=t.split(" "),h=0,o=n.length;o>h;h++)i=n[h],(r=this._callbacks)[i]||(r[i]=[]),this._callbacks[i].push(e);return this},e.prototype.once=function(t,e){return this.on(t,function(){return this.off(t,arguments.callee),e.apply(this,arguments)}),this},e.prototype.trigger=function(){var e,n,i,r,h,o,l;if(e=arguments.length>=1?t.call(arguments,0):[],i=e.shift(),r=null!=(l=this._callbacks)?l[i]:void 0){for(h=0,o=r.length;o>h&&(n=r[h],n.apply(this,e)!==!1);h++);return this}},e.prototype.off=function(t,e){var n,i,r,h,o,l;if(!t)return this._callbacks={},this;if(r=null!=(l=this._callbacks)?l[t]:void 0,!r)return this;if(!e)return delete this._callbacks[t],this;for(i=h=0,o=r.length;o>h;i=++h)if(n=r[i],n===e){r=r.slice(),r.splice(i,1),this._callbacks[t]=r;break}return this},e}(),function(){var t,n,r,h,o;return r={},t=null,n=function(){return e.Deferred(function(n){return e(function(){return t=e('<div id="calcNaturalWH-tempholder"></div>').css({position:"absolute",left:"-9999px",top:"-9999px"}),e("body").append(t),n.resolve()})}).promise()},h=function(t){return null==t.naturalWidth||0===t.naturalWidth||null==t.naturalHeight||0===t.naturalHeight?!1:!0},o=function(n,i){var h,o,l,u,c,a;return n=n.clone(),u=n[0],l=e.Deferred(),a={},n.css({width:"auto",height:"auto"}),h=e("<div></div>").append(n),t.append(h),o=0,c=function(){return a.width=u.naturalWidth||n.width(),a.height=u.naturalHeight||n.height(),o>10?(h.remove(),l.reject()):a.width&&a.height?(r[i],h.remove(),l.resolve(a)):(o++,wait(100).done(function(){return c()}))},c(),l.promise()},i.calcNaturalWH=e.ImgLoaderNs.createCachedFunction(function(t,i){return e.loadImg(i).then(function(e){var l,u;return l=e[0],h(l)?(u={width:l.naturalWidth,height:l.naturalHeight},r[i]=u,t.resolve(u,e)):n().done(function(){return o(e,i).then(function(n){return t.resolve(n,e)},function(){return t.reject()})})},function(){return t.reject()})})}(),i.calcRectFitImgWH=function(){var t,n,r;return t=function(t,e){return t>e?t:e},n=function(t,e,n,i){var r,h;return n>t&&i>e?{width:t,height:e}:(h=n/t,r=i/e,r>h?{width:n,height:Math.ceil(e*h)}:h>r?{width:Math.ceil(t*r),height:i}:h===r?{width:t*h,height:e*r}:void 0)},r=function(t){return{width:100*t.width,height:100*t.height}},function(t,h){var o,l,u,c;return u=e.extend({width:null,height:null,enlargeSmallImg:!0,returnClonedImg:!0},h),o=e.Deferred(),c=function(t,e){var i;return u.enlargeSmallImg&&(t=r(t)),u.returnClonedImg&&(e=e.clone()),i=n(t.width,t.height,u.width,u.height),o.resolve({width:i.width,height:i.height,img:e})},l=function(){return o.reject()},i.calcNaturalWH(t).then(c,l),o.promise()}}(),i.ImgFillRect=function(t){function r(t,n){var r,h,o=this;this.$el=t,this.options=e.extend(i.ImgFillRect.defaults,n),h=this.$el.attr("data-imgfillrect-src"),h&&(this.options.src=h),this.rectWidth=this.$el.width(),this.rectHeight=this.$el.height(),this.options.oninit&&(r={rectWidth:this.rectWidth,rectHeight:this.rectHeight,el:this.$el},this.options.oninit(r)),this.loadImg().then(function(t,n){var i,r,h;i=o.calcImgSize(t),r=o.calcAdjustStyles(i),h=e.extend(i,r),n.css(h),o.$el.empty().append(n)},function(){o.options.onfail&&o.options.onfail()})}return n(r,t),r.defaults={src:null,oninit:null,onfail:null,cloneImg:!0},r.prototype.loadImg=function(){var t,n=this;return t=e.Deferred(),i.calcNaturalWH(this.options.src).then(function(e,i){return n.options.cloneImg&&(i=i.clone()),t.resolve(e,i)},function(){return t.reject()}),t.promise()},r.prototype.calcImgSize=function(t){var e,n,i,r,h,o,l,u;return o={},r=this.rectWidth,i=this.rectHeight,n=t.width,e=t.height,u=function(){var t,h;return h=r/n,t=Math.floor(h*e),i>t?!1:{adjustedImgWidth:r,adjustedImgHeight:t}},l=function(){var t,h;return h=i/e,t=Math.floor(h*n),r>t?!1:{adjustedImgWidth:t,adjustedImgHeight:i}},h=u(),h===!1&&(h=l()),o.width=h.adjustedImgWidth,o.height=h.adjustedImgHeight,o},r.prototype.calcAdjustStyles=function(t){var e,n,i,r,h;return h={},r=this.rectWidth,i=this.rectHeight,n=t.width,e=t.height,n>r&&(h.left=-1*Math.floor((n-r)/2)),e>i&&(h.top=-1*Math.floor((e-i)/2)),h},r}(i.Event),e.fn.imgFillRect=function(t){return this.each(function(n,r){var h;return h=e(r),h.data("imgfillrect",new i.ImgFillRect(h,t))})},e.imgUtil=i})(jQuery,window,document)}).call(this);