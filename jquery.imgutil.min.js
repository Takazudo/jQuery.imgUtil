/*! jQuery.imgUtil (https://github.com/Takazudo/jQuery.imgUtil)
 * lastupdate: 2014-09-30
 * version: 0.5.0
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){var t={}.hasOwnProperty,i=function(i,e){function r(){this.constructor=i}for(var n in e)t.call(e,n)&&(i[n]=e[n]);return r.prototype=e.prototype,i.prototype=new r,i.__super__=e.prototype,i};(function(t){var e;return e={},e.createCachedFunction=function(i){var e;return e={},function(r,n){return e[r]||(e[r]=t.Deferred(function(t){return i(t,r,n)}).promise()),e[r]}},e.loadImg=function(i){var e,r,n;return r=t.Deferred(),n=new Image,e=function(){return n.onload=n.onerror=null},n.onload=function(){return e(),r.resolve(t(n))},n.onerror=function(){return e(),r.reject(t(n))},n.src=i,r.promise()},function(){var i,r,n,h,o;return n={},i=null,r=function(){return t.Deferred(function(e){return t(function(){return i=t('<div id="calcNaturalWH-tempholder"></div>').css({position:"absolute",left:"-9999px",top:"-9999px"}),t("body").append(i),e.resolve()})}).promise()},h=function(t){return null==t.naturalWidth||0===t.naturalWidth||null==t.naturalHeight||0===t.naturalHeight?!1:!0},o=function(e,r){var h,o,c,g,u,l;return e=e.clone(),g=e[0],c=t.Deferred(),l={},e.css({width:"auto",height:"auto"}),h=t("<div></div>").append(e),i.append(h),o=0,u=function(){return l.width=g.naturalWidth||e.width(),l.height=g.naturalHeight||e.height(),o>10?(h.remove(),c.reject()):l.width&&l.height?(n[r],h.remove(),c.resolve(l)):(o++,wait(100).done(function(){return u()}))},u(),c.promise()},e.calcNaturalWH=e.createCachedFunction(function(t,i){return e.loadImg(i).then(function(e){var c,g;return c=e[0],h(c)?(g={width:c.naturalWidth,height:c.naturalHeight},n[i]=g,t.resolve(g,e)):r().done(function(){return o(e,i).then(function(i){return t.resolve(i,e)},function(){return t.reject()})})},function(){return t.reject()})})}(),e.calcStylesToBeContainedInRect=function(){var i;return i={imgWidth:null,imgHeight:null,rectWidth:null,rectHeight:null},function(e){var r,n;return r=t.extend({},i,e),n={},n.left=r.imgWidth<r.rectWidth?Math.floor((r.rectWidth-r.imgWidth)/2):0,n.top=r.imgHeight<r.rectHeight?Math.floor((r.rectHeight-r.imgHeight)/2):0,n}}(),e.calcRectContainImgWH=function(){var i,e;return e=function(t){return t.imgWidth=100*t.imgWidth,t.imgHeight=100*t.imgHeight,t},i={imgWidth:null,imgHeight:null,rectWidth:null,rectHeight:null,enlargeSmallImg:!0},function(r){var n,h,o;return n=t.extend({},i,r),n.enlargeSmallImg&&(n=e(n)),n.imgWidth<n.rectWidth&&n.imgHeight<n.rectHeight?{width:n.imgWidth,height:n.imgHeight}:(o=n.rectWidth/n.imgWidth,h=n.rectHeight/n.imgHeight,h>o?{width:n.rectWidth,height:Math.ceil(n.imgHeight*o)}:o>h?{width:Math.ceil(n.imgWidth*h),height:n.rectHeight}:o===h?{width:n.imgWidth*o,height:n.imgHeight*h}:void 0)}}(),e.calcStylesToCoverRect=function(){var i;return i={imgWidth:null,imgHeight:null,rectWidth:null,rectHeight:null},function(e){var r,n;return r=t.extend({},i,e),n={},n.left=r.imgWidth>r.rectWidth?-1*Math.floor((r.imgWidth-r.rectWidth)/2):0,n.top=r.imgHeight>r.rectHeight?-1*Math.floor((r.imgHeight-r.rectHeight)/2):0,n}}(),e.calcRectCoverImgWH=function(){var i;return i={imgWidth:null,imgHeight:null,rectWidth:null,rectHeight:null},function(e){var r,n,h,o;return r=t.extend({},i,e),o=function(){var t,i;return i=r.rectWidth/r.imgWidth,t=Math.floor(i*r.imgHeight),r.rectHeight>t?!1:{width:r.rectWidth,height:t}},h=function(){var t,i;return i=r.rectHeight/r.imgHeight,t=Math.floor(i*r.imgWidth),r.rectWidth>t?!1:{width:t,height:r.rectHeight}},n=o(),n===!1&&(n=h(),n===!1&&(n.width=r.rectWidth,n.height=r.rectHeight)),n}}(),e.AbstractImgRectFitter=function(){function i(){var t,i;i=this.$el.attr(this.options.attr_src),i&&(this.options.src=i),this.options.oninit&&(t={el:this.$el},this.options.oninit(t)),this._doFirstRefresh()}return i.prototype._doFirstRefresh=function(){var t=this;return this._stillLoadingImg=!0,this._calcNaturalImgWH().done(function(){return t._stillLoadingImg=!1,t.refresh()}),this},i.prototype._calcNaturalImgWH=function(){var i,r,n,h=this;return i=t.Deferred(),n=function(t,e){h.originalImgWidth=t.width,h.originalImgHeight=t.height,h.options.cloneImg&&(e=e.clone()),h.$img=e,i.resolve()},r=function(){h.options.onfail&&h.options.onfail(),i.reject()},e.calcNaturalWH(this.options.src).then(n,r),i.promise()},i.prototype._putImg=function(t){return this.options.overrideImgPut?this.options.overrideImgPut(this.$el,t):this.$el.empty().append(t),this},i.prototype._finalizeImg=function(t){var i,e;return this.options.useNewImgElOnRefresh?(i=this.$img.clone(),i.css(t),this._putImg(i)):(this.$img.css(t),e=this.$el.find("img"),0===e.length&&this._putImg(this.$img)),this},i}(),e.ImgCoverRect=function(r){function n(i,r){this.$el=i,this.options=t.extend({},e.ImgCoverRect.defaults,r),n.__super__.constructor.apply(this,arguments)}return i(n,r),n.defaults={src:null,oninit:null,onfail:null,cloneImg:!0,useNewImgElOnRefresh:!1,attr_src:"data-imgcoverrect-src",overrideImgPut:null},n.prototype.refresh=function(){var i,r,n;if(this._stillLoadingImg!==!0)return this.rectWidth=this.$el.width(),this.rectHeight=this.$el.height(),i=e.calcRectCoverImgWH({imgWidth:this.originalImgWidth,imgHeight:this.originalImgHeight,rectWidth:this.rectWidth,rectHeight:this.rectHeight}),n={width:i.width,height:i.height},r=e.calcStylesToCoverRect({imgWidth:i.width,imgHeight:i.height,rectWidth:this.rectWidth,rectHeight:this.rectHeight}),n=t.extend(n,r),this._finalizeImg(n),this},n}(e.AbstractImgRectFitter),function(){var i;return i="imgcoverrect",t.fn.imgCoverRect=function(r){return this.each(function(n,h){var o;return o=t(h),o.data(i,new e.ImgCoverRect(o,r))})},t.fn.refreshImgCoverRect=function(){return this.each(function(e,r){var n,h;return n=t(r),(h=n.data(i))?h.refresh():void 0})}}(),e.ImgContainRect=function(r){function n(i,r){this.$el=i,this.options=t.extend({},e.ImgContainRect.defaults,r),n.__super__.constructor.apply(this,arguments)}return i(n,r),n.defaults={src:null,oninit:null,onfail:null,cloneImg:!0,enlargeSmallImg:!0,useNewImgElOnRefresh:!1,attr_src:"data-imgcontainrect-src",overrideImgPut:null},n.prototype.refresh=function(){var i,r,n;if(this._stillLoadingImg!==!0)return this.rectWidth=this.$el.width(),this.rectHeight=this.$el.height(),i=e.calcRectContainImgWH({imgWidth:this.originalImgWidth,imgHeight:this.originalImgHeight,rectWidth:this.rectWidth,rectHeight:this.rectHeight}),n={width:i.width,height:i.height},r=e.calcStylesToBeContainedInRect({imgWidth:i.width,imgHeight:i.height,rectWidth:this.rectWidth,rectHeight:this.rectHeight}),n=t.extend(n,r),this._finalizeImg(n),this},n}(e.AbstractImgRectFitter),function(){var i;return i="imgcontainrect",t.fn.imgContainRect=function(r){return this.each(function(n,h){var o;return o=t(h),o.data(i,new e.ImgContainRect(o,r))})},t.fn.refreshImgContainRect=function(){return this.each(function(e,r){var n,h;return n=t(r),(h=n.data(i))?h.refresh():void 0})}}(),t.imgUtil=e})(jQuery,window,document)}).call(this);