/*! jQuery.imgUtil (https://github.com/Takazudo/jQuery.imgUtil)
 * lastupdate: 2013-05-25
 * version: 0.3.0
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){var t={}.hasOwnProperty,i=function(i,e){function r(){this.constructor=i}for(var n in e)t.call(e,n)&&(i[n]=e[n]);return r.prototype=e.prototype,i.prototype=new r,i.__super__=e.prototype,i};(function(t){var e;return e={},function(){var i,r,n,h,c;return n={},i=null,r=function(){return t.Deferred(function(e){return t(function(){return i=t('<div id="calcNaturalWH-tempholder"></div>').css({position:"absolute",left:"-9999px",top:"-9999px"}),t("body").append(i),e.resolve()})}).promise()},h=function(t){return null==t.naturalWidth||0===t.naturalWidth||null==t.naturalHeight||0===t.naturalHeight?!1:!0},c=function(e,r){var h,c,o,g,l,u;return e=e.clone(),g=e[0],o=t.Deferred(),u={},e.css({width:"auto",height:"auto"}),h=t("<div></div>").append(e),i.append(h),c=0,l=function(){return u.width=g.naturalWidth||e.width(),u.height=g.naturalHeight||e.height(),c>10?(h.remove(),o.reject()):u.width&&u.height?(n[r],h.remove(),o.resolve(u)):(c++,wait(100).done(function(){return l()}))},l(),o.promise()},e.calcNaturalWH=t.ImgLoaderNs.createCachedFunction(function(i,e){return t.loadImg(e).then(function(t){var o,g;return o=t[0],h(o)?(g={width:o.naturalWidth,height:o.naturalHeight},n[e]=g,i.resolve(g,t)):r().done(function(){return c(t,e).then(function(e){return i.resolve(e,t)},function(){return i.reject()})})},function(){return i.reject()})})}(),e.calcStylesToBeContainedInRect=function(){var i;return i={imgWidth:null,imgHeight:null,rectWidth:null,rectHeight:null},function(e){var r,n;return r=t.extend({},i,e),n={},n.left=r.imgWidth<r.rectWidth?Math.floor((r.rectWidth-r.imgWidth)/2):0,n.top=r.imgHeight<r.rectHeight?Math.floor((r.rectHeight-r.imgHeight)/2):0,n}}(),e.calcRectContainImgWH=function(){var i,e;return e=function(t){return t.imgWidth=100*t.imgWidth,t.imgHeight=100*t.imgHeight,t},i={imgWidth:null,imgHeight:null,rectWidth:null,rectHeight:null,enlargeSmallImg:!0},function(r){var n,h,c;return n=t.extend({},i,r),n.enlargeSmallImg&&(n=e(n)),n.imgWidth<n.rectWidth&&n.imgHeight<n.rectHeight?{width:n.imgWidth,height:n.imgHeight}:(c=n.rectWidth/n.imgWidth,h=n.rectHeight/n.imgHeight,h>c?{width:n.rectWidth,height:Math.ceil(n.imgHeight*c)}:c>h?{width:Math.ceil(n.imgWidth*h),height:n.rectHeight}:c===h?{width:n.imgWidth*c,height:n.imgHeight*h}:void 0)}}(),e.calcStylesToCoverRect=function(){var i;return i={imgWidth:null,imgHeight:null,rectWidth:null,rectHeight:null},function(e){var r,n;return r=t.extend({},i,e),n={},n.left=r.imgWidth>r.rectWidth?-1*Math.floor((r.imgWidth-r.rectWidth)/2):0,n.top=r.imgHeight>r.rectHeight?-1*Math.floor((r.imgHeight-r.rectHeight)/2):0,n}}(),e.calcRectCoverImgWH=function(){var i;return i={imgWidth:null,imgHeight:null,rectWidth:null,rectHeight:null},function(e){var r,n,h,c;return r=t.extend({},i,e),c=function(){var t,i;return i=r.rectWidth/r.imgWidth,t=Math.floor(i*r.imgHeight),r.rectHeight>t?!1:{width:r.rectWidth,height:t}},h=function(){var t,i;return i=r.rectHeight/r.imgHeight,t=Math.floor(i*r.imgWidth),r.rectWidth>t?!1:{width:t,height:r.rectHeight}},n=c(),n===!1&&(n=h(),n===!1&&(n.width=r.rectWidth,n.height=r.rectHeight)),n}}(),e.AbstractImgRectFitter=function(){function i(){var t,i;i=this.$el.attr(this.options.attr_src),i&&(this.options.src=i),this.options.oninit&&(t={el:this.$el},this.options.oninit(t)),this._doFirstRefresh()}return i.prototype._doFirstRefresh=function(){var t=this;return this._stillLoadingImg=!0,this._calcNaturalImgWH().done(function(){return t._stillLoadingImg=!1,t.refresh()}),this},i.prototype._calcNaturalImgWH=function(){var i,r,n,h=this;return i=t.Deferred(),n=function(t,e){h.originalImgWidth=t.width,h.originalImgHeight=t.height,h.options.cloneImg&&(e=e.clone()),h.$img=e,i.resolve()},r=function(){h.options.onfail&&h.options.onfail(),i.reject()},e.calcNaturalWH(this.options.src).then(n,r),i.promise()},i.prototype._finalizeImg=function(t){var i,e;return this.options.useNewImgElOnRefresh?(i=this.$img.clone(),i.css(t),this.$el.empty().append(i)):(this.$img.css(t),e=this.$el.find("img"),0===e.length&&this.$el.empty().append(this.$img)),this},i}(),e.ImgCoverRect=function(r){function n(i,r){this.$el=i,this.options=t.extend({},e.ImgCoverRect.defaults,r),n.__super__.constructor.apply(this,arguments)}return i(n,r),n.defaults={src:null,oninit:null,onfail:null,cloneImg:!0,useNewImgElOnRefresh:!1,attr_src:"data-imgcoverrect-src"},n.prototype.refresh=function(){var i,r,n;if(this._stillLoadingImg!==!0)return this.rectWidth=this.$el.width(),this.rectHeight=this.$el.height(),i=e.calcRectCoverImgWH({imgWidth:this.originalImgWidth,imgHeight:this.originalImgHeight,rectWidth:this.rectWidth,rectHeight:this.rectHeight}),n={width:i.width,height:i.height},r=e.calcStylesToCoverRect({imgWidth:i.width,imgHeight:i.height,rectWidth:this.rectWidth,rectHeight:this.rectHeight}),n=t.extend(n,r),this._finalizeImg(n),this},n}(e.AbstractImgRectFitter),function(){var i;return i="imgcoverrect",t.fn.imgCoverRect=function(r){return this.each(function(n,h){var c;return c=t(h),c.data(i,new e.ImgCoverRect(c,r))})},t.fn.refreshImgCoverRect=function(){return this.each(function(e,r){var n,h;return n=t(r),(h=n.data(i))?h.refresh():void 0})}}(),e.ImgContainRect=function(r){function n(i,r){this.$el=i,this.options=t.extend({},e.ImgContainRect.defaults,r),n.__super__.constructor.apply(this,arguments)}return i(n,r),n.defaults={src:null,oninit:null,onfail:null,cloneImg:!0,enlargeSmallImg:!0,useNewImgElOnRefresh:!1,attr_src:"data-imgcontainrect-src"},n.prototype.refresh=function(){var i,r,n;if(this._stillLoadingImg!==!0)return this.rectWidth=this.$el.width(),this.rectHeight=this.$el.height(),i=e.calcRectContainImgWH({imgWidth:this.originalImgWidth,imgHeight:this.originalImgHeight,rectWidth:this.rectWidth,rectHeight:this.rectHeight}),n={width:i.width,height:i.height},r=e.calcStylesToBeContainedInRect({imgWidth:i.width,imgHeight:i.height,rectWidth:this.rectWidth,rectHeight:this.rectHeight}),n=t.extend(n,r),this._finalizeImg(n),this},n}(e.AbstractImgRectFitter),function(){var i;return i="imgcontainrect",t.fn.imgContainRect=function(r){return this.each(function(n,h){var c;return c=t(h),c.data(i,new e.ImgContainRect(c,r))})},t.fn.refreshImgContainRect=function(){return this.each(function(e,r){var n,h;return n=t(r),(h=n.data(i))?h.refresh():void 0})}}(),t.imgUtil=e})(jQuery,window,document)}).call(this);