/*! jQuery.imgUtil (https://github.com/Takazudo/jQuery.imgUtil)
 * lastupdate: 2013-05-24
 * version: 0.2.0
 * author: 'Takazudo' Takeshi Takatsudo <takazudo@gmail.com>
 * License: MIT */
(function(){(function(t){var e;return e={},function(){var i,n,r,h,o;return r={},i=null,n=function(){return t.Deferred(function(e){return t(function(){return i=t('<div id="calcNaturalWH-tempholder"></div>').css({position:"absolute",left:"-9999px",top:"-9999px"}),t("body").append(i),e.resolve()})}).promise()},h=function(t){return null==t.naturalWidth||0===t.naturalWidth||null==t.naturalHeight||0===t.naturalHeight?!1:!0},o=function(e,n){var h,o,c,u,a,l;return e=e.clone(),u=e[0],c=t.Deferred(),l={},e.css({width:"auto",height:"auto"}),h=t("<div></div>").append(e),i.append(h),o=0,a=function(){return l.width=u.naturalWidth||e.width(),l.height=u.naturalHeight||e.height(),o>10?(h.remove(),c.reject()):l.width&&l.height?(r[n],h.remove(),c.resolve(l)):(o++,wait(100).done(function(){return a()}))},a(),c.promise()},e.calcNaturalWH=t.ImgLoaderNs.createCachedFunction(function(e,i){return t.loadImg(i).then(function(t){var c,u;return c=t[0],h(c)?(u={width:c.naturalWidth,height:c.naturalHeight},r[i]=u,e.resolve(u,t)):n().done(function(){return o(t,i).then(function(i){return e.resolve(i,t)},function(){return e.reject()})})},function(){return e.reject()})})}(),e.calcRectFitImgWH=function(){var i,n,r;return i=function(t,e){return t>e?t:e},n=function(t,e,i,n){var r,h;return i>t&&n>e?{width:t,height:e}:(h=i/t,r=n/e,r>h?{width:i,height:Math.ceil(e*h)}:h>r?{width:Math.ceil(t*r),height:n}:h===r?{width:t*h,height:e*r}:void 0)},r=function(t){return{width:100*t.width,height:100*t.height}},function(i,h){var o,c,u,a;return u=t.extend({width:null,height:null,enlargeSmallImg:!0,returnClonedImg:!0},h),o=t.Deferred(),a=function(t,e){var i;return u.enlargeSmallImg&&(t=r(t)),u.returnClonedImg&&(e=e.clone()),i=n(t.width,t.height,u.width,u.height),o.resolve({width:i.width,height:i.height,img:e})},c=function(){return o.reject()},e.calcNaturalWH(i).then(a,c),o.promise()}}(),e.ImgCoverRect=function(){function i(i,n){var r,h,o=this;this.$el=i,this.options=t.extend(e.ImgCoverRect.defaults,n),h=this.$el.attr("data-imgcoverrect-src"),h&&(this.options.src=h),this.rectWidth=this.$el.width(),this.rectHeight=this.$el.height(),this.options.oninit&&(r={rectWidth:this.rectWidth,rectHeight:this.rectHeight,el:this.$el},this.options.oninit(r)),this.loadImg().then(function(e,i){var n,r,h;n=o.calcImgSize(e),r=o.calcAdjustStyles(n),h=t.extend(n,r),i.css(h),o.$el.empty().append(i)},function(){o.options.onfail&&o.options.onfail()})}return i.defaults={src:null,oninit:null,onfail:null,cloneImg:!0},i.prototype.loadImg=function(){var i,n=this;return i=t.Deferred(),e.calcNaturalWH(this.options.src).then(function(t,e){return n.options.cloneImg&&(e=e.clone()),i.resolve(t,e)},function(){return i.reject()}),i.promise()},i.prototype.calcImgSize=function(t){var e,i,n,r,h,o,c,u;return o={},r=this.rectWidth,n=this.rectHeight,i=t.width,e=t.height,u=function(){var t,h;return h=r/i,t=Math.floor(h*e),n>t?!1:{adjustedImgWidth:r,adjustedImgHeight:t}},c=function(){var t,h;return h=n/e,t=Math.floor(h*i),r>t?!1:{adjustedImgWidth:t,adjustedImgHeight:n}},h=u(),h===!1&&(h=c()),o.width=h.adjustedImgWidth,o.height=h.adjustedImgHeight,o},i.prototype.calcAdjustStyles=function(t){var e,i,n,r,h;return h={},r=this.rectWidth,n=this.rectHeight,i=t.width,e=t.height,i>r&&(h.left=-1*Math.floor((i-r)/2)),e>n&&(h.top=-1*Math.floor((e-n)/2)),h},i}(),t.fn.imgCoverRect=function(i){return this.each(function(n,r){var h;return h=t(r),h.data("imgcoverrect",new e.ImgCoverRect(h,i))})},e.ImgContainRect=function(){function i(i,n){var r,h,o=this;this.$el=i,this.options=t.extend(e.ImgContainRect.defaults,n),h=this.$el.attr("data-imgcontainrect-src"),h&&(this.options.src=h),this.rectWidth=this.$el.width(),this.rectHeight=this.$el.height(),this.options.oninit&&(r={rectWidth:this.rectWidth,rectHeight:this.rectHeight,el:this.$el},this.options.oninit(r)),this.calcImgSize().then(function(e){var i,n,r;i=e.img,r={width:e.width,height:e.height},n=o.calcAdjustStyles(r),r=t.extend(r,n),i.css(r),o.$el.empty().append(i)},function(){o.options.onfail&&o.options.onfail()})}return i.defaults={src:null,oninit:null,onfail:null,cloneImg:!0,enlargeSmallImg:!0},i.prototype.calcImgSize=function(){var i,n;return i=t.Deferred(),n={width:this.rectWidth,height:this.rectHeight,enlargeSmallImg:!0,returnClonedImg:this.options.cloneImg},e.calcRectFitImgWH(this.options.src,n).then(function(t){return i.resolve(t)},function(){return i.reject()}),i.promise()},i.prototype.calcAdjustStyles=function(t){var e,i,n,r,h;return h={},r=this.rectWidth,n=this.rectHeight,i=t.width,e=t.height,r>i&&(h.left=Math.floor((r-i)/2)),n>e&&(h.top=Math.floor((n-e)/2)),h},i}(),t.fn.imgContainRect=function(i){return this.each(function(n,r){var h;return h=t(r),h.data("imgcontainrect",new e.ImgContainRect(h,i))})},t.imgUtil=e})(jQuery,window,document)}).call(this);